{
  "$schema": "https://json-schema.org/draft/2019-09/schema",
  "type": "object",
  "title": "Netbox Helm Chart Values Schema",
  "description": "JSON Schema for Netbox Helm chart values with dependency management",
  "properties": {
    "netbox": {
      "type": "object",
      "description": "Netbox application configuration",
      "properties": {
        "image": {
          "type": "object",
          "description": "Container image configuration",
          "properties": {
            "registry": {
              "type": "string",
              "description": "Container registry",
              "default": "ghcr.io"
            },
            "repository": {
              "type": "string",
              "description": "Image repository",
              "default": "netbox-community/netbox"
            },
            "pullPolicy": {
              "type": "string",
              "enum": ["Always", "Never", "IfNotPresent"],
              "description": "Image pull policy",
              "default": "IfNotPresent"
            },
            "tag": {
              "type": "string",
              "description": "Image tag (defaults to chart appVersion)"
            },
            "digest": {
              "type": "string",
              "description": "Image digest to override tag"
            },
            "pullSecrets": {
              "type": "array",
              "description": "Array of image pull secrets",
              "items": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },
        "superuser": {
          "type": "object",
          "description": "NetBox superuser configuration",
          "properties": {
            "name": {
              "type": "string",
              "description": "Superuser username",
              "default": "admin"
            },
            "email": {
              "type": "string",
              "format": "email",
              "description": "Superuser email address",
              "default": "admin@example.com"
            },
            "password": {
              "type": "string",
              "description": "Superuser password"
            },
            "apiToken": {
              "type": "string",
              "description": "API token for superuser"
            },
            "existingSecret": {
              "type": "string",
              "description": "Existing secret containing superuser credentials"
            }
          },
          "additionalProperties": false
        },
        "allowedHosts": {
          "type": "array",
          "description": "List of valid FQDNs for NetBox server",
          "items": {
            "type": "string"
          },
          "default": ["*"]
        },
        "admins": {
          "type": "array",
          "description": "List of NetBox administrators (name, email tuples)",
          "items": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "minItems": 2,
            "maxItems": 2
          }
        },
        "banner": {
          "type": "object",
          "description": "Banner configuration for UI",
          "properties": {
            "top": {
              "type": "string",
              "description": "Banner text at top of every page (HTML allowed)"
            },
            "bottom": {
              "type": "string",
              "description": "Banner text at bottom of every page (HTML allowed)"
            },
            "login": {
              "type": "string",
              "description": "Text on login page above login form (HTML allowed)"
            }
          },
          "additionalProperties": false
        },
        "cors": {
          "type": "object",
          "description": "API Cross-Origin Resource Sharing (CORS) settings",
          "properties": {
            "originAllowAll": {
              "type": "boolean",
              "description": "Allow all origins",
              "default": false
            },
            "originWhitelist": {
              "type": "array",
              "description": "List of allowed origins",
              "items": {
                "type": "string"
              }
            },
            "originRegexWhitelist": {
              "type": "array",
              "description": "List of allowed origin regex patterns",
              "items": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },
        "csrf": {
          "type": "object",
          "description": "Cross-Site Request Forgery (CSRF) settings",
          "properties": {
            "cookieName": {
              "type": "string",
              "description": "CSRF cookie name",
              "default": "csrftoken"
            },
            "trustedOrigins": {
              "type": "array",
              "description": "List of trusted origins for unsafe requests (must include scheme)",
              "items": {
                "type": "string",
                "pattern": "^https?://"
              }
            }
          },
          "additionalProperties": false
        },
        "defaultLanguage": {
          "type": "string",
          "description": "Default preferred language/locale",
          "default": "en-ca"
        },
        "storages": {
          "type": "object",
          "description": "Storage backend configuration for uploaded files",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "BACKEND": {
                "type": "string",
                "description": "Storage backend class"
              },
              "OPTIONS": {
                "type": "object",
                "description": "Backend-specific options",
                "additionalProperties": true
              }
            }
          }
        },
        "plugins": {
          "type": "array",
          "description": "List of enabled plugin names",
          "items": {
            "type": "string"
          }
        },
        "pluginsConfig": {
          "type": "object",
          "description": "Plugin configuration settings",
          "additionalProperties": {
            "type": "object"
          }
        },
        "extraConfig": {
          "type": "array",
          "description": "Additional YAML configuration files",
          "items": {
            "type": "object",
            "properties": {
              "values": {
                "type": "object",
                "description": "Arbitrary configuration values"
              },
              "configMap": {
                "type": "object",
                "description": "ConfigMap reference",
                "properties": {
                  "name": { "type": "string" },
                  "items": { "type": "array" },
                  "optional": { "type": "boolean" }
                }
              },
              "secret": {
                "type": "object",
                "description": "Secret reference",
                "properties": {
                  "secretName": { "type": "string" },
                  "items": { "type": "array" },
                  "optional": { "type": "boolean" }
                }
              }
            }
          }
        },
        "secretKey": {
          "type": "string",
          "description": "Session encryption token (50+ random characters)"
        },
        "existingSecret": {
          "type": "string",
          "description": "Existing secret containing secret_key"
        },
        "replicaCount": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of NetBox replicas",
          "default": 1
        },
        "persistence": {
          "type": "object",
          "description": "Data persistence configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable data persistence",
              "default": true
            },
            "storageClass": {
              "oneOf": [
                { "type": "string" },
                { "type": "null" }
              ],
              "description": "Storage class name"
            },
            "subPath": {
              "type": "string",
              "description": "Mount subpath"
            },
            "accessMode": {
              "type": "string",
              "enum": ["ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany"],
              "description": "Access mode",
              "default": "ReadWriteOnce"
            },
            "size": {
              "type": "string",
              "description": "Storage size",
              "default": "1Gi"
            },
            "existingClaim": {
              "type": "string",
              "description": "Existing PVC name"
            },
            "annotations": {
              "type": "object",
              "description": "PVC annotations",
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },
        "reportsPersistence": {
          "type": "object",
          "description": "Reports storage persistence configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable reports persistence",
              "default": false
            },
            "existingClaim": {
              "type": "string",
              "description": "Existing PVC name"
            },
            "subPath": {
              "type": "string",
              "description": "Mount subpath"
            },
            "storageClass": {
              "oneOf": [
                { "type": "string" },
                { "type": "null" }
              ],
              "description": "Storage class name"
            },
            "accessMode": {
              "type": "string",
              "enum": ["ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany"],
              "description": "Access mode"
            },
            "size": {
              "type": "string",
              "description": "Storage size"
            },
            "annotations": {
              "type": "object",
              "description": "PVC annotations",
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },
        "scriptsPersistence": {
          "type": "object",
          "description": "Scripts storage persistence configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable scripts persistence",
              "default": false
            },
            "existingClaim": {
              "type": "string",
              "description": "Existing PVC name"
            },
            "subPath": {
              "type": "string",
              "description": "Mount subpath"
            },
            "storageClass": {
              "oneOf": [
                { "type": "string" },
                { "type": "null" }
              ],
              "description": "Storage class name"
            },
            "accessMode": {
              "type": "string",
              "enum": ["ReadWriteOnce", "ReadOnlyMany", "ReadWriteMany"],
              "description": "Access mode"
            },
            "size": {
              "type": "string",
              "description": "Storage size"
            },
            "annotations": {
              "type": "object",
              "description": "PVC annotations",
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        },
        "httpRoute": {
          "type": "object",
          "description": "Kubernetes Gateway API HTTPRoute configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable HTTPRoute resource",
              "default": false
            },
            "parentRefs": {
              "type": "array",
              "description": "Gateway parent references",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "namespace": { "type": "string" }
                }
              }
            },
            "hostnames": {
              "type": "array",
              "description": "List of hostnames for the route",
              "items": {
                "type": "string"
              }
            },
            "filters": {
              "type": "array",
              "description": "HTTPRoute filters",
              "items": {
                "type": "object"
              }
            }
          },
          "additionalProperties": true
        },
        "metrics": {
          "type": "object",
          "description": "Prometheus metrics configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Prometheus metrics",
              "default": false
            },
            "serviceMonitor": {
              "type": "object",
              "description": "Prometheus Operator ServiceMonitor configuration",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable ServiceMonitor",
                  "default": false
                },
                "honorLabels": {
                  "type": "boolean",
                  "description": "Honor labels from target",
                  "default": false
                },
                "interval": {
                  "type": "string",
                  "description": "Scrape interval"
                },
                "scrapeTimeout": {
                  "type": "string",
                  "description": "Scrape timeout"
                },
                "metricRelabelings": {
                  "type": "array",
                  "description": "Metric relabeling configurations",
                  "items": {
                    "type": "object"
                  }
                },
                "relabelings": {
                  "type": "array",
                  "description": "Relabeling configurations",
                  "items": {
                    "type": "object"
                  }
                },
                "selector": {
                  "type": "object",
                  "description": "Prometheus instance selector"
                },
                "additionalLabels": {
                  "type": "object",
                  "description": "Additional labels for ServiceMonitor",
                  "additionalProperties": {
                    "type": "string"
                  }
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "postgresql": {
          "type": "object",
          "description": "PostgreSQL chart dependency configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable bundled PostgreSQL chart",
              "default": true
            },
            "auth": {
              "type": "object",
              "description": "PostgreSQL authentication configuration",
              "properties": {
                "username": {
                  "type": "string",
                  "description": "PostgreSQL username",
                  "default": "netbox"
                },
                "database": {
                  "type": "string",
                  "description": "PostgreSQL database name",
                  "default": "netbox"
                },
                "password": {
                  "type": "string",
                  "description": "PostgreSQL password"
                }
              },
              "additionalProperties": true
            }
          },
          "additionalProperties": true
        },
        "externalDatabase": {
          "type": "object",
          "description": "External database configuration (when postgresql.enabled=false)",
          "properties": {
            "host": {
              "type": "string",
              "description": "Database host",
              "default": "localhost"
            },
            "port": {
              "type": "integer",
              "description": "Database port",
              "default": 5432
            },
            "database": {
              "type": "string",
              "description": "Database name",
              "default": "netbox"
            },
            "username": {
              "type": "string",
              "description": "Database username",
              "default": "netbox"
            },
            "password": {
              "type": "string",
              "description": "Database password"
            },
            "existingSecretName": {
              "type": "string",
              "description": "Existing secret with database credentials"
            },
            "existingSecretKey": {
              "type": "string",
              "description": "Key in existing secret for password",
              "default": "postgresql-password"
            },
            "engine": {
              "type": "string",
              "description": "Database engine",
              "default": "django.db.backends.postgresql"
            },
            "connMaxAge": {
              "type": "integer",
              "description": "Maximum connection age in seconds",
              "default": 300
            },
            "disableServerSideCursors": {
              "type": "boolean",
              "description": "Disable server-side cursors",
              "default": false
            },
            "options": {
              "type": "object",
              "description": "Additional database connection options",
              "properties": {
                "sslmode": {
                  "type": "string",
                  "enum": ["require", "prefer", "allow", "disable"],
                  "description": "SSL mode",
                  "default": "prefer"
                },
                "target_session_attrs": {
                  "type": "string",
                  "description": "Target session attributes",
                  "default": "read-write"
                }
              },
              "additionalProperties": {
                "type": "string"
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
