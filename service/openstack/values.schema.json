{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "backup": {
      "type": "boolean",
      "description": "Enable backup functionality"
    },
    "policies": {
      "type": "object",
      "properties": {
        "network": {
          "type": "boolean",
          "description": "Enable network policies"
        },
        "admin": {
          "type": "boolean",
          "description": "Enable admin policies"
        }
      },
      "required": ["network", "admin"]
    },
    "certificate": {
      "type": "object",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Create SSL certificate secret"
        },
        "name": {
          "type": "string",
          "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
          "description": "Certificate secret name"
        },
        "ca": {
          "type": "string",
          "description": "CA certificate in PEM format"
        },
        "cert": {
          "type": "string",
          "description": "SSL certificate in PEM format"
        },
        "key": {
          "type": "string",
          "description": "SSL private key in PEM format"
        }
      },
      "required": ["create", "name"]
    },
    "deployment": {
      "type": "object",
      "properties": {
        "create": {
          "type": "boolean",
          "description": "Create OpenStack deployment"
        },
        "name": {
          "type": "string",
          "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
          "description": "Deployment name"
        },
        "region": {
          "type": "object",
          "properties": {
            "domain": {
              "type": "string",
              "pattern": "^[a-z0-9.-]+$",
              "description": "OpenStack region domain"
            },
            "name": {
              "type": "string",
              "description": "OpenStack region name"
            },
            "preset": {
              "type": "string",
              "enum": ["core", "compute"],
              "description": "OpenStack preset configuration"
            },
            "size": {
              "type": "string",
              "enum": ["single", "tiny", "small", "medium", "large"],
              "description": "OpenStack deployment size"
            },
            "version": {
              "type": "string",
              "enum": ["antelope", "bobcat", "caracal", "dalmatian"],
              "description": "OpenStack version"
            }
          },
          "required": ["domain", "name", "preset", "size", "version"]
        },
        "storage": {
          "type": "object",
          "properties": {
            "local": {
              "type": "string",
              "description": "Local storage configuration"
            },
            "persistent": {
              "type": "string",
              "description": "Persistent storage configuration"
            }
          },
          "required": ["local", "persistent"]
        }
      },
      "required": ["create", "name", "region", "storage"]
    },
    "keystone": {
      "type": "object",
      "properties": {
        "keycloak": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Keycloak integration"
            },
            "url": {
              "type": "string",
              "pattern": "^https?://.*",
              "description": "Keycloak URL"
            },
            "sslServerValidation": {
              "type": "boolean",
              "description": "Enable SSL server validation"
            },
            "sslAuthValidation": {
              "type": "boolean",
              "description": "Enable SSL auth validation"
            }
          },
          "required": ["enabled"]
        },
        "values": {
          "type": "object",
          "description": "Keystone configuration values"
        }
      },
      "required": ["keycloak"]
    },
    "glance": {
      "type": "object",
      "properties": {
        "backend": {
          "type": "string",
          "enum": ["file", "swift", "ceph", "s3"],
          "description": "Glance storage backend"
        },
        "signature": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable image signature verification"
            }
          },
          "required": ["enabled"]
        },
        "pvcstore": {
          "type": "object",
          "properties": {
            "default": {
              "type": "boolean",
              "description": "Use as default storage"
            },
            "class": {
              "type": "string",
              "description": "Storage class for PVC"
            },
            "size": {
              "type": "string",
              "pattern": "^[0-9]+[KMGT]i$",
              "description": "PVC size"
            }
          },
          "required": ["default"]
        }
      },
      "required": ["backend", "signature", "pvcstore"]
    },
    "cinder": {
      "type": "object",
      "properties": {
        "backends": {
          "type": "string",
          "enum": ["lvm", "ceph", "nfs"],
          "description": "Cinder storage backend"
        },
        "volumeGroup": {
          "type": "string",
          "description": "LVM volume group name"
        },
        "values": {
          "type": "object",
          "description": "Cinder configuration values"
        }
      },
      "required": ["volumeGroup"]
    },
    "nova": {
      "type": "object",
      "properties": {
        "migrationInterface": {
          "type": "string",
          "description": "Network interface for migration"
        },
        "cpuType": {
          "type": "string",
          "enum": ["host-passthrough", "host-model", "custom"],
          "description": "CPU type for VMs"
        },
        "allocation": {
          "type": "object",
          "properties": {
            "cpu": {
              "type": "integer",
              "minimum": 1,
              "description": "CPU allocation ratio"
            },
            "disk": {
              "type": "integer",
              "minimum": 1,
              "description": "Disk allocation ratio"
            },
            "ram": {
              "type": "integer",
              "minimum": 1,
              "description": "RAM allocation ratio"
            }
          }
        },
        "console": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable console access"
            },
            "tls": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable TLS for console"
                }
              },
              "required": ["enabled"]
            }
          },
          "required": ["enabled"]
        },
        "libvirt": {
          "type": "object",
          "properties": {
            "tls": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable TLS for libvirt"
                }
              },
              "required": ["enabled"]
            }
          }
        },
        "images": {
          "type": "object",
          "properties": {
            "backend": {
              "type": "string",
              "enum": ["qcow2", "ceph", "lvm"],
              "description": "Nova images backend"
            },
            "lvm": {
              "type": "object",
              "properties": {
                "volumeGroup": {
                  "type": "string",
                  "description": "LVM volume group for images"
                }
              },
              "required": ["volumeGroup"]
            },
            "encryption": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable image encryption"
                },
                "cipher": {
                  "type": "string",
                  "enum": ["aes-xts-plain64", "aes-cbc-essiv"],
                  "description": "Encryption cipher"
                },
                "key_size": {
                  "type": "integer",
                  "enum": [128, 192, 256],
                  "description": "Encryption key size"
                }
              },
              "required": ["enabled"]
            }
          },
          "required": ["backend", "encryption"]
        },
        "values": {
          "type": "object",
          "description": "Nova configuration values"
        }
      },
      "required": ["migrationInterface", "cpuType", "console", "images"]
    },
    "neutron": {
      "type": "object",
      "properties": {
        "tunnelInterface": {
          "type": "string",
          "description": "Network interface for tunnels"
        },
        "ipsec": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable IPSec"
            }
          },
          "required": ["enabled"]
        },
        "dvr": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Distributed Virtual Router"
            }
          },
          "required": ["enabled"]
        },
        "nameservers": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "ipv4",
            "description": "DNS nameserver IP address"
          },
          "description": "List of DNS nameservers"
        },
        "networks": {
          "type": "object",
          "properties": {
            "external": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "bridge": {
                    "type": "string",
                    "pattern": "^br-[a-z0-9]+$",
                    "description": "Bridge name"
                  },
                  "networkTypes": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": ["flat", "vlan", "vxlan"]
                    },
                    "description": "Network types"
                  }
                },
                "required": ["bridge", "networkTypes"]
              }
            },
            "floating": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable floating IP network"
                },
                "subnet": {
                  "type": "object",
                  "properties": {
                    "range": {
                      "type": "string",
                      "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$",
                      "description": "Subnet CIDR range"
                    },
                    "gateway": {
                      "type": "string",
                      "format": "ipv4",
                      "description": "Gateway IP address"
                    },
                    "pool": {
                      "type": "object",
                      "properties": {
                        "start": {
                          "type": "string",
                          "format": "ipv4",
                          "description": "Pool start IP"
                        },
                        "end": {
                          "type": "string",
                          "format": "ipv4",
                          "description": "Pool end IP"
                        }
                      },
                      "required": ["start", "end"]
                    }
                  },
                  "required": ["range", "gateway", "pool"]
                }
              },
              "required": ["enabled"]
            }
          },
          "required": ["external", "floating"]
        },
        "values": {
          "type": "object",
          "description": "Neutron configuration values"
        }
      },
      "required": ["tunnelInterface", "ipsec", "dvr", "nameservers", "networks"]
    },
    "openvswitch": {
      "type": "object",
      "properties": {
        "values": {
          "type": "object",
          "description": "Open vSwitch configuration values"
        }
      }
    },
    "octavia": {
      "type": "object",
      "properties": {
        "subnets": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "range": {
                "type": "string",
                "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$",
                "description": "Subnet CIDR range"
              },
              "pool": {
                "type": "object",
                "properties": {
                  "start": {
                    "type": "string",
                    "format": "ipv4",
                    "description": "Pool start IP"
                  },
                  "end": {
                    "type": "string",
                    "format": "ipv4",
                    "description": "Pool end IP"
                  }
                },
                "required": ["start", "end"]
              }
            },
            "required": ["range", "pool"]
          },
          "description": "Octavia load balancer subnets"
        }
      },
      "required": ["subnets"]
    },
    "heat": {
      "type": "object",
      "properties": {
        "values": {
          "type": "object",
          "description": "Heat configuration values"
        }
      }
    },
    "operator": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable Rockoon operator"
        }
      },
      "required": ["enabled"]
    }
  },
  "required": ["backup", "policies", "certificate", "deployment", "keystone", "glance", "cinder", "nova", "neutron", "openvswitch", "octavia", "heat", "operator"]
}
