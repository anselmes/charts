{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "MaaS Chart Values Schema",
  "description": "Schema for MaaS (Metal as a Service) chart values that deploys MaaS and its dependencies",
  "properties": {
    "dependencies": {
      "type": "object",
      "description": "MaaS dependency configuration",
      "properties": {
        "static": {
          "type": "object",
          "description": "Static dependency definitions",
          "additionalProperties": {
            "type": "object"
          }
        }
      },
      "additionalProperties": true
    },
    "network_policy": {
      "type": "object",
      "description": "Network policy configuration",
      "properties": {
        "maas": {
          "type": "object",
          "properties": {
            "ingress": {
              "type": "array",
              "items": {
                "type": "object"
              }
            },
            "egress": {
              "type": "array",
              "items": {
                "type": "object"
              }
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "manifests": {
      "type": "object",
      "description": "Kubernetes manifest toggles",
      "properties": {
        "region_statefulset": {
          "type": "boolean",
          "description": "Deploy region controller statefulset"
        },
        "rack_statefulset": {
          "type": "boolean",
          "description": "Deploy rack controller statefulset"
        },
        "syslog_statefulset": {
          "type": "boolean",
          "description": "Deploy syslog statefulset"
        },
        "syslog_service": {
          "type": "boolean",
          "description": "Deploy syslog service"
        },
        "test_maas_api": {
          "type": "boolean",
          "description": "Deploy API test resources"
        },
        "secret_ssh_key": {
          "type": "boolean",
          "description": "Create SSH key secret"
        },
        "ingress_region": {
          "type": "boolean",
          "description": "Deploy region ingress"
        },
        "configmap_ingress": {
          "type": "boolean",
          "description": "Deploy ingress configmap"
        },
        "maas_ingress": {
          "type": "boolean",
          "description": "Deploy MaaS ingress"
        },
        "network_policy": {
          "type": "boolean",
          "description": "Deploy network policies"
        }
      },
      "additionalProperties": false
    },
    "labels": {
      "type": "object",
      "description": "Pod and node selector labels",
      "properties": {
        "rack": {
          "type": "object",
          "properties": {
            "node_selector_key": {
              "type": "string"
            },
            "node_selector_value": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "region": {
          "type": "object",
          "properties": {
            "node_selector_key": {
              "type": "string"
            },
            "node_selector_value": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "ingress": {
          "type": "object",
          "properties": {
            "node_selector_key": {
              "type": "string"
            },
            "node_selector_value": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "syslog": {
          "type": "object",
          "properties": {
            "node_selector_key": {
              "type": "string"
            },
            "node_selector_value": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "test": {
          "type": "object",
          "properties": {
            "node_selector_key": {
              "type": "string"
            },
            "node_selector_value": {
              "type": "string"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "network": {
      "type": "object",
      "description": "Network configuration",
      "properties": {
        "region_api": {
          "type": "object",
          "properties": {
            "ingress": {
              "type": "object",
              "properties": {
                "public": {
                  "type": "boolean",
                  "description": "Enable public ingress"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "storage": {
      "type": "object",
      "description": "Storage configuration",
      "properties": {
        "syslog": {
          "type": "object",
          "properties": {
            "pvc": {
              "type": "object",
              "properties": {
                "class_name": {
                  "type": "string",
                  "description": "Storage class name"
                },
                "size": {
                  "type": "string",
                  "pattern": "^[0-9]+[KMGTPE]?i?$",
                  "description": "Storage size"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "rackd": {
          "type": "object",
          "properties": {
            "pvc": {
              "type": "object",
              "properties": {
                "class_name": {
                  "type": "string",
                  "description": "Storage class name"
                },
                "size": {
                  "type": "string",
                  "pattern": "^[0-9]+[KMGTPE]?i?$",
                  "description": "Storage size"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "conf": {
      "type": "object",
      "description": "MaaS configuration settings",
      "properties": {
        "ssh": {
          "type": "object",
          "properties": {
            "private_key": {
              "type": ["string", "null"],
              "description": "SSH private key for virsh access"
            }
          },
          "additionalProperties": false
        },
        "bind": {
          "type": "object",
          "properties": {
            "override": {
              "type": ["string", "null"]
            },
            "append": {
              "type": ["string", "null"]
            },
            "cpus": {
              "type": ["integer", "string"],
              "description": "Number of CPUs for bind to use"
            }
          },
          "additionalProperties": false
        },
        "nginx": {
          "type": "object",
          "properties": {
            "worker_processes": {
              "type": ["integer", "string"],
              "description": "Number of nginx worker processes"
            },
            "worker_connections": {
              "type": "integer",
              "description": "Number of worker connections"
            }
          },
          "additionalProperties": false
        },
        "curtin": {
          "type": "object",
          "properties": {
            "override": {
              "type": "boolean"
            },
            "late_commands": {
              "type": "object",
              "description": "Additional commands for late curtin stage",
              "additionalProperties": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "additionalProperties": false
        },
        "cloudconfig": {
          "type": "object",
          "properties": {
            "override": {
              "type": "boolean"
            },
            "sections": {
              "type": "object",
              "description": "Additional cloud-config sections",
              "additionalProperties": true
            }
          },
          "additionalProperties": false
        },
        "cache": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable caching"
            }
          },
          "additionalProperties": false
        },
        "syslog": {
          "type": "object",
          "properties": {
            "logpath": {
              "type": "string",
              "description": "Log file path"
            },
            "logfile": {
              "type": "string",
              "description": "Log file name"
            },
            "logrotate": {
              "type": "object",
              "properties": {
                "count": {
                  "type": "integer",
                  "description": "Number of rotated logs to keep"
                },
                "rotate": {
                  "type": ["integer", "string"],
                  "description": "Log rotation count"
                },
                "size": {
                  "type": "string",
                  "description": "Log rotation size"
                }
              },
              "additionalProperties": false
            },
            "log_level": {
              "type": "string",
              "enum": ["emerg", "alert", "crit", "error", "warning", "notice", "info", "debug"],
              "description": "Syslog level"
            }
          },
          "additionalProperties": false
        },
        "maas": {
          "type": "object",
          "properties": {
            "override": {
              "type": ["string", "null"]
            },
            "append": {
              "type": ["string", "null"]
            },
            "url": {
              "type": "object",
              "properties": {
                "maas_url": {
                  "type": ["string", "null"],
                  "format": "uri",
                  "description": "MaaS URL"
                }
              },
              "additionalProperties": false
            },
            "cgroups": {
              "type": "object",
              "properties": {
                "disable_cgroups_rack": {
                  "type": "boolean",
                  "description": "Disable cgroups for rack controller"
                },
                "disable_cgroups_region": {
                  "type": "boolean",
                  "description": "Disable cgroups for region controller"
                }
              },
              "additionalProperties": false
            },
            "ntp": {
              "type": "object",
              "properties": {
                "use_external_only": {
                  "type": "boolean",
                  "description": "Use external NTP only"
                },
                "disable_ntpd_rack": {
                  "type": "boolean",
                  "description": "Disable ntpd on rack controller"
                },
                "disable_ntpd_region": {
                  "type": "boolean",
                  "description": "Disable ntpd on region controller"
                },
                "ntp_servers": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "NTP servers"
                }
              },
              "additionalProperties": false
            },
            "dns": {
              "type": "object",
              "properties": {
                "require_dnssec": {
                  "type": "boolean",
                  "description": "Require DNSSEC"
                },
                "dns_servers": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "DNS servers"
                }
              },
              "additionalProperties": false
            },
            "proxy": {
              "type": "object",
              "properties": {
                "peer_proxy_enabled": {
                  "type": "boolean",
                  "description": "Enable peer proxy"
                },
                "proxy_enabled": {
                  "type": "boolean",
                  "description": "Enable proxy"
                },
                "proxy_server": {
                  "type": ["string", "null"],
                  "description": "Proxy server"
                }
              },
              "additionalProperties": false
            },
            "images": {
              "type": "object",
              "properties": {
                "default_os": {
                  "type": "string",
                  "description": "Default OS"
                },
                "default_image": {
                  "type": "string",
                  "description": "Default image"
                },
                "default_kernel": {
                  "type": "string",
                  "description": "Default kernel"
                }
              },
              "additionalProperties": false
            },
            "credentials": {
              "type": "object",
              "properties": {
                "secret": {
                  "type": ["string", "object", "null"]
                }
              },
              "additionalProperties": false
            },
            "syslog": {
              "type": "object",
              "properties": {
                "remote_syslog": {
                  "type": ["string", "null"],
                  "description": "Remote syslog destination"
                }
              },
              "additionalProperties": false
            },
            "extra_settings": {
              "type": "object",
              "properties": {
                "enlist_commissioning": {
                  "type": "boolean",
                  "description": "Enable enlist commissioning"
                }
              },
              "additionalProperties": true
            },
            "system_user": {
              "type": "string",
              "description": "System user for console login"
            },
            "system_passwd": {
              "type": "string",
              "description": "System password"
            },
            "tls": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable TLS"
                },
                "create": {
                  "type": "boolean",
                  "description": "Create TLS certificates"
                },
                "insecure": {
                  "type": "boolean",
                  "description": "Allow insecure connections"
                },
                "ca": {
                  "type": "string",
                  "description": "CA certificate"
                },
                "cert": {
                  "type": "string",
                  "description": "TLS certificate"
                },
                "key": {
                  "type": "string",
                  "description": "TLS private key"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "secrets": {
      "type": "object",
      "description": "Secret configuration",
      "properties": {
        "maas_db": {
          "type": "object",
          "properties": {
            "admin": {
              "type": "string"
            },
            "user": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "maas_users": {
          "type": "object",
          "properties": {
            "admin": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "maas_region": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            }
          },
          "additionalProperties": false
        },
        "ssh_key": {
          "type": "string"
        },
        "maas_cert": {
          "type": "string"
        },
        "maas_ingress_cert": {
          "type": "string"
        }
      },
      "additionalProperties": false
    },
    "pod": {
      "type": "object",
      "description": "Pod configuration",
      "properties": {
        "replicas": {
          "type": "object",
          "properties": {
            "rack": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of rack controller replicas"
            },
            "region": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of region controller replicas"
            },
            "syslog": {
              "type": "integer",
              "minimum": 1,
              "description": "Number of syslog replicas"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "endpoints": {
      "type": "object",
      "description": "Service endpoint configuration",
      "properties": {
        "cluster_domain_suffix": {
          "type": "string",
          "description": "Kubernetes cluster domain suffix"
        },
        "maas_syslog": {
          "type": "object",
          "properties": {
            "hosts": {
              "type": "object",
              "properties": {
                "default": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "host_fqdn_override": {
              "type": "object",
              "properties": {
                "default": {
                  "type": ["string", "null"]
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "maas_db": {
          "type": "object",
          "properties": {
            "auth": {
              "type": "object",
              "properties": {
                "admin": {
                  "type": "object"
                },
                "user": {
                  "type": "object"
                }
              },
              "additionalProperties": false
            },
            "host_fqdn_override": {
              "type": "object",
              "additionalProperties": true
            },
            "path": {
              "type": "string"
            },
            "hosts": {
              "type": "object"
            }
          },
          "additionalProperties": false
        },
        "maas_region": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "auth": {
              "type": "object",
              "properties": {
                "admin": {
                  "type": "object",
                  "properties": {
                    "username": {
                      "type": "string"
                    },
                    "password": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "hosts": {
              "type": "object",
              "properties": {
                "default": {
                  "type": "string"
                },
                "public": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "path": {
              "type": "object",
              "properties": {
                "default": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "scheme": {
              "type": "object",
              "properties": {
                "default": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            "host_fqdn_override": {
              "type": "object",
              "properties": {
                "default": {
                  "type": ["string", "null"]
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "cert_manager": {
      "type": "object",
      "description": "Certificate manager configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable cert-manager integration"
        },
        "create": {
          "type": "boolean",
          "description": "Create certificates"
        },
        "issuer": {
          "type": "object",
          "properties": {
            "kind": {
              "type": "string",
              "enum": ["Issuer", "ClusterIssuer"],
              "description": "Issuer kind"
            },
            "name": {
              "type": "string",
              "description": "Issuer name"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "data": {
      "type": "object",
      "description": "Data services configuration (dependency)",
      "properties": {
        "postgres": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable PostgreSQL"
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "gateway": {
      "type": "object",
      "description": "Gateway configuration (dependency)",
      "properties": {
        "gateways": {
          "type": ["array", "null"],
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
                "description": "Gateway name"
              }
            },
            "additionalProperties": false
          },
          "description": "Gateway configurations"
        },
        "routes": {
          "type": ["array", "null"],
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
                "description": "Route name"
              },
              "kind": {
                "type": "string",
                "enum": ["HTTPRoute", "TCPRoute", "UDPRoute", "TLSRoute"],
                "description": "Route kind"
              },
              "hostnames": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "hostname"
                },
                "description": "Route hostnames"
              },
              "rules": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "matches": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "path": {
                            "type": "object",
                            "properties": {
                              "type": {
                                "type": "string",
                                "enum": ["Exact", "PathPrefix", "RegularExpression"]
                              },
                              "value": {
                                "type": "string"
                              }
                            },
                            "additionalProperties": false
                          }
                        },
                        "additionalProperties": false
                      }
                    },
                    "backendRefs": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string"
                          },
                          "port": {
                            "type": "integer",
                            "minimum": 1,
                            "maximum": 65535
                          }
                        },
                        "additionalProperties": false
                      }
                    }
                  },
                  "additionalProperties": false
                }
              },
              "gateways": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "namespace": {
                      "type": "string",
                      "description": "Gateway namespace"
                    }
                  },
                  "additionalProperties": false
                }
              }
            },
            "additionalProperties": false
          },
          "description": "Gateway routes configuration"
        },
        "policies": {
          "type": ["array", "null"],
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "pattern": "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$",
                "description": "Policy name"
              }
            },
            "additionalProperties": false
          },
          "description": "Gateway policies configuration"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
